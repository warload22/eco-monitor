{% extends "base.html" %}

{% block title %}–û—Ç—á–µ—Ç—ã - EcoMonitor{% endblock %}

{% block extra_head %}
<style>
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .stat-card.avg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-card.max { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .stat-card.min { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .stat-card.count { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    
    .table-safe {
        background-color: #d4edda !important;
    }
    
    .table-danger-custom {
        background-color: #f8d7da !important;
    }
    
    #dataTable {
        font-size: 0.9rem;
    }
    
    .loading-spinner {
        display: none;
    }
    
    .loading-spinner.active {
        display: inline-block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5 text-success">üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã</h1>
            <p class="lead text-muted">–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</p>
        </div>
    </div>
    
    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç—á–µ—Ç–∞ -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á–µ—Ç–∞</h5>
            <form id="reportForm">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="parameterSelect" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ *</label>
                        <select class="form-select" id="parameterSelect" required>
                            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤...</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="dateFrom" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                        <input type="datetime-local" class="form-control" id="dateFrom">
                    </div>
                    <div class="col-md-3">
                        <label for="dateTo" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="datetime-local" class="form-control" id="dateTo">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100">
                            <span class="loading-spinner spinner-border spinner-border-sm me-2" role="status"></span>
                            –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="summaryContainer" style="display: none;">
        <div class="row mb-4">
            <div class="col">
                <h4 class="mb-3">–°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: <span id="parameterName" class="text-success"></span></h4>
                <p class="text-muted" id="periodInfo"></p>
            </div>
        </div>
        
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="stat-card avg">
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</div>
                    <div class="stat-value" id="avgValue">-</div>
                    <div class="stat-unit" id="avgUnit"></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card max">
                    <div class="stat-label">–ú–∞–∫—Å–∏–º—É–º</div>
                    <div class="stat-value" id="maxValue">-</div>
                    <div class="stat-unit" id="maxUnit"></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card min">
                    <div class="stat-label">–ú–∏–Ω–∏–º—É–º</div>
                    <div class="stat-value" id="minValue">-</div>
                    <div class="stat-unit" id="minUnit"></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card count">
                    <div class="stat-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π</div>
                    <div class="stat-value" id="countValue">-</div>
                    <div class="stat-unit"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ -->
    <div id="dataContainer" style="display: none;">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">–î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π</h5>
                <button class="btn btn-light btn-sm" id="exportCsvBtn">
                    üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-striped" id="dataTable">
                        <thead class="table-success">
                            <tr>
                                <th>#</th>
                                <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                                <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–¢–æ—á–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</th>
                                <th>–†–∞–π–æ–Ω</th>
                                <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </tbody>
                    </table>
                </div>
                <p class="text-muted mt-3 mb-0" id="recordsCount"></p>
            </div>
        </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ -->
    <div id="noDataMessage" class="alert alert-warning" style="display: none;">
        <strong>–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á–µ—Ç–∞.
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/reports.js') }}"></script>
{% endblock %}
